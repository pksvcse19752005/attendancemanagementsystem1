<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Attendance Management System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
<div class="container mt-3">
    <h2 class="text-center mb-4">Attendance Management System</h2>

    <!-- Login Section -->
    <div id="loginSection">
        <form id="loginForm">
            <div class="mb-3">
                <label for="usernameInput" class="form-label">Username</label>
                <input type="text" id="usernameInput" class="form-control" required/>
            </div>
            <div class="mb-3">
                <label for="passwordInput" class="form-label">Password</label>
                <input type="password" id="passwordInput" class="form-control" required/>
            </div>
            <button type="submit" class="btn btn-primary">Login</button>
            <button type="button" class="btn btn-link" onclick="showForgotPassword()">Forgot Password?</button>
        </form>
        <div id="loginMessage" class="mt-2 text-danger"></div>
    </div>

    <!-- Forgot Password Section -->
    <div id="forgotSection" style="display:none;">
        <form id="forgotForm">
            <div class="mb-3">
                <label for="forgotUsernameInput" class="form-label">Username</label>
                <input type="text" id="forgotUsernameInput" class="form-control" required/>
            </div>
            <button type="submit" class="btn btn-warning">Send Reset Link</button>
            <button type="button" class="btn btn-link" onclick="showLogin()">Back to Login</button>
        </form>
        <div id="forgotMessage" class="mt-2 text-info"></div>
    </div>

    <!-- Attendance Section -->
    <div id="attendanceSection" style="display:none;">
        <h4>Mark Attendance</h4>
        <form id="attendanceForm">
            <div class="mb-3">
                <label for="dateInput" class="form-label">Date</label>
                <input type="date" id="dateInput" class="form-control" required/>
            </div>
            <div class="mb-3">
                <label for="sectionSelect" class="form-label">Select Section</label>
                <select id="sectionSelect" class="form-select" required>
                    <option value="" disabled selected>Select a section</option>
                    <option value="A">Section A</option>
                    <option value="B">Section B</option>
                    <option value="C">Section C</option>
                    <option value="D">Section D</option>
                </select>
            </div>
            <div id="studentsList"></div>
            <button type="submit" class="btn btn-success mt-3">Submit Attendance</button>
        </form>
        <button class="btn btn-info mt-3" onclick="exportAbsentees()">Export Absentees</button>
        <button class="btn btn-outline-secondary mt-3 ms-2" onclick="logout()">Logout</button>
        <div id="attendanceMessage" class="mt-2"></div>
    </div>

    <!-- Check Attendance Section -->
    <div id="checkSection" class="mt-4">
        <h4>Check Your Attendance</h4>
        <form id="checkForm">
            <div class="mb-3">
                <label for="regnoInput" class="form-label">Registration Number</label>
                <input type="text" id="regnoInput" class="form-control" required/>
            </div>
            <div class="mb-3">
                <label for="checkDateInput" class="form-label">Date</label>
                <input type="date" id="checkDateInput" class="form-control" required/>
            </div>
            <button type="submit" class="btn btn-primary">Check</button>
        </form>
        <div id="checkMessage" class="mt-2"></div>
    </div>
</div>
<script>
    const sectionStudents = {
  A: [
    ['23KD1A0501', 'ABDUL GUFFRAN'],['23KD1A0502', 'ADAPAKA TEJASRI'],['23KD1A0503', 'ADDANKI MAHESWARI'],['23KD1A0504', 'ALAMANDA SANJANA BLESSY'],
    ['23KD1A0505', 'ALAVELLI SRIPRIYA'],['23KD1A0506', 'AAMUDALA RAJESH'],['23KD1A0507', 'APPANA PRANEETH KUMAR'],['23KD1A0508', 'BADIGANTI MANOJ'],
    ['23KD1A0509', 'BAGGAM BHAVANASRI'],['23KD1A0510', 'BALIVADA MRUDULA'],['23KD1A0511', 'BANGARU VANDHANA'],['23KD1A0512', 'BANKI SAI MONISH'],
    ['23KD1A0513', 'BATTULA SAI KUMAR'],['23KD1A0514', 'BAYYA AKHIL'],['23KD1A0515', 'BEVARA DEVI PRASAD'],['23KD1A0516', 'BHASKARA AKSHAYA KUNDANIKA'],
    ['23KD1A0517', 'BHOGAPURAPU SAI MEGHANA'],['23KD1A0518', 'BITRA GIRIDDHAR'],['23KD1A0519', 'BODASINGI SIRISHA'],['23KD1A0520', 'BODDETI VYSHNAVI'],
    ['23KD1A0521', 'BODDU APPALA RAJU'],['23KD1A0522', 'BOGADI NAGAMANI'],['23KD1A0523', 'BONTHU SRUTHI'],['23KD1A0524', 'BURADA MEGHANA'],
    ['23KD1A0525', 'CHALICHAMA LOKESH SEETHARAM'],['23KD1A0526', 'CHANDAKA BHARATH KUMAR'],['23KD1A0527', 'CHANDAKA PAVITHRA'],['23KD1A0528', 'CHAPPA BHUVANA SAI'],
    ['23KD1A0529', 'CHILAKALAPUDI SRIVALLI'],['23KD1A0530', 'CHINTALAPATI LAKSHMI'],['23KD1A0531', 'CHITROTHU RAHUL KRISHNA'],['23KD1A0532', 'CHOKKAPU MOHAN SATHVIK'],
    ['23KD1A0533', 'CHUKKA JNANACHARAN'],['23KD1A0534', 'CHUKKA SAI KIRAN'],['23KD1A0535', 'DACHEPALLI MADHUMITHA'],['23KD1A0537', 'DANDU UDAY KIRAN'],
    ['23KD1A0538', 'DASARI LOVA RAJU'],['23KD1A0539', 'DASARI MOHAN'],['23KD1A0540', 'DASARI SURESH'],['23KD1A0541', 'DATLA SEETHARAMARAJU'],
    ['23KD1A0542', 'DATTI ANU'],['23KD1A0543', 'DEEPATI MOHITH'],['23KD1A0544', 'DEVU VENKATAVIVEK'],['23KD1A0545', 'DOKARA SURESH'],
    ['23KD1A0546', 'DORA KARTHIK'],['23KD1A0547', 'DUMPALA SANYASIRAO'],['23KD1A0548', 'DUVVU TEJESWAR'],['23KD1A0549', 'ELURU BHANUSHANKAR'],
    ['23KD1A0550', 'ESSARAPU AVINASH'],['23KD1A0551', 'ETTLA MARY AKSHITHA'],['23KD1A0552', 'FARHEEN MUNAVVAR FATHIMA'],['23KD1A0553', 'GADABANTI GANESH'],
    ['23KD1A0554', 'GANDATE ROHIT KUMAR'],['23KD1A0555', 'GANDHULI MONIKA'],['23KD1A0556', 'GANDRETI GEETHA SRI'],['23KD1A0557', 'GANDUBARIKI PRAGNA'],
    ['23KD1A0558', 'GARE TEJASWINI'],['23KD1A0559', 'GARI VENKATAMANIKANTA'],['23KD1A0560', 'GEDALA CHARMILA DEVI SRI'],['23KD1A0561', 'GEDALA DIVYA'],
    ['23KD1A0562', 'GEDELA SATEESH'],['23KD1A0563', 'GOLLU ADITYA'],['23KD1A0564', 'GOLLU PAVAN KUMAR'],['23KD1A0565', 'GORLE HARITHA'],
    ['23KD1A0566', 'GOTTAPU LAKSHMI CHARAN'],['22KD1A0575', 'KANDUKURI ABHILASH'],['24KD5A0501', 'BANDARU SREERAM'],['24KD5A0502', 'BAVISETTI MANOJ KUMAR'],
    ['24KD5A0503', 'BENDI BHAVANI'],['24KD5A0504', 'BONDA SURESH'],['24KD5A0505', 'GOLAJANI JHANSI'],['20KD1A05G5', 'SIMMITI KARUNA BABU']
  ],
  B: [
    ['23KD1A0567', 'GRANDHI MANASA'],['23KD1A0568', 'GUDDALA JAHNAVI'],['23KD1A0569', 'GUDEPU YASWANTH'],['23KD1A0570', 'GUDLA BHARATHI RATHNA KUMARI'],
    ['23KD1A0571', 'GULAMAJJI BHARGAV'],['23KD1A0572', 'GUNANA SAILAJA'],['23KD1A0573', 'GUNDU PRIYANKA'],['23KD1A0574', 'GUNTUKU ABHISHEK SAI'],
    ['23KD1A0575', 'GURRALA NAGA VARSHITHA'],['23KD1A0576', 'GURUGU VINAY KUMAR'],['23KD1A0577', 'HARIDASULA HARSHA VARDHAN'],['23KD1A0578', 'IMANDI HARISH'],
    ['23KD1A0579', 'IMANDI MYTHRI'],['23KD1A0580', 'IMMIDISETTI SNEHITHA'],['23KD1A0581', 'JAMI INDUMATHI'],['23KD1A0582', 'JAMPA HARSHITHA'],
    ['23KD1A0583', 'JAMPARANGI DINESH KUMAR'],['23KD1A0584', 'JARAJAPU DURGA PRASAD'],['23KD1A0585', 'JARJAPU PRASANTH'],['23KD1A0586', 'JUTTADA SWETHA'],
    ['23KD1A0587', 'JYOTHSNA ARDHAHAKULA'],['23KD1A0588', 'KAKARLAPUDI NARASIMHA ANIRUDH VARMA'],['23KD1A0589', 'KALISETTI DEEPAK'],['23KD1A0590', 'KALISETTI HARINI'],
    ['23KD1A0591', 'KALIVARAPU NAMRATHA'],['23KD1A0592', 'KALLA VENKATA HIRAN MAAVI'],['23KD1A0593', 'KALYAMPUDI RAVI KIRAN'],['23KD1A0594', 'KALYANAM GOWTHAMI'],
    ['23KD1A0596', 'KANCHUPARTHI JYOTHSNA'],['23KD1A0597', 'KANDI ASHISH'],['23KD1A0598', 'KANURI PUJITHA'],['23KD1A0599', 'KARRI DIVYA RANI'],
    ['23KD1A05A0', 'KARRI RAKSHITHA'],['23KD1A05A1', 'KARRI SATYA GOWTHAM KUMAR REDDY'],['23KD1A05A2', 'KASIREDDY JYOTHI SHIVANANDH'],['23KD1A05A3', 'KATTAMURI PRAVALLIKA'],
    ['23KD1A05A4', 'KATTOJU ABILESH'],['23KD1A05A5', 'KELLA MITHIN KUMAR'],['23KD1A05A6', 'KILLO CHINNI PRAKASH'],['23KD1A05A8', 'KOLA ABHISHEK'],
    ['23KD1A05A9', 'KOLA VARSHINI'],['23KD1A05B0', 'KOLAGANA POORNA CHANDRA RAO'],['23KD1A05B1', 'KOLLA SRAVANI'],['23KD1A05B2', 'KOLUSU ABHINAYA ANJALI'],
    ['23KD1A05B3', 'KONADA RASHMITHA'],['23KD1A05B4', 'KONDAKA SOWMYA'],['23KD1A05B5', 'KONDAPU RAMI REDDY'],['23KD1A05B6', 'KORADA JAGADEESH'],
    ['23KD1A05B7', 'KORADA NAGA DEVI'],['23KD1A05B8', 'KOSARA AKASH'],['23KD1A05B9', 'KOSIREDDY SAI KUMAR'],['23KD1A05C0', 'KOTTAKOTA KAVERI'],
    ['23KD1A05C1', 'KOTYADA BHARGAVI'],['23KD1A05C2', 'KOTYADA MAHESH'],['23KD1A05C3', 'KOVVURI CHARAN KUMAR REDDY'],['23KD1A05C5', 'KOVVURU KIRANSAI'],
    ['23KD1A05C6', 'KURIMINELLI POOJITHA'],['23KD1A05C7', 'LENKA BHARGAVI'],['23KD1A05C8', 'LODAGALA THARUN'],['23KD1A05C9', 'MADHABATHULA MANOJ KUMAR'],
    ['23KD1A05D0', 'MAJJI BHANUSRI'],['23KD1A05D1', 'MAMIDI MARUTHI PRASAD'],['23KD1A05D2', 'NAGIREDLA SRAVANI'],['24KD5A0506', 'GOLLU DURGAPRASAD'],
    ['24KD5A0507', 'GUNDU BALU'],['24KD5A0508', 'JAJIMOGGALA SRAVANTHI'],['24KD5A0509', 'KOTNANA LAHARI'],['24KD5A0510', 'MADDI KUMAR'],
    ['24KD5A0511', 'MANDALA MAHESH NAIDU']
  ],
  C: [
    ['23KD1A05D3', 'M BHARGAVI'],['23KD1A05D4', 'M PRAVALLIKA'],['23KD1A05D5', 'M VARAPRASAD'],['23KD1A05D6', 'M MEGHANA'],
    ['23KD1A05D7', 'M SWETHA'],['23KD1A05D8', 'M ABHINAV'],['23KD1A05D9', 'M NAVYATHA'],['23KD1A05E0', 'M SINDHUJA'],
    ['23KD1A05E1', 'M PRANATHI'],['23KD1A05E2', 'M HARSHITHA'],['23KD1A05E3', 'M SHARMILA'],['23KD1A05E4', 'M SHAILAJA'],
    ['23KD1A05E5', 'MOHSIN ALI'],['23KD1A05E6', 'M FARHEEN BEGUM'],['23KD1A05E7', 'M VAMSI KRISHNA'],['23KD1A05E8', 'M MADHURI'],
    ['23KD1A05E9', 'M SARAYU SRI'],['23KD1A05F0', 'M YUVA KIRAN'],['23KD1A05F1', 'M JYOTHSNA'],['23KD1A05F2', 'M BENSON'],
    ['23KD1A05F3', 'M BHARAT'],['23KD1A05F4', 'M MANOJ KUMAR'],['23KD1A05F5', 'N DEVI'],['23KD1A05F6', 'N ADHARSH'],
    ['23KD1A05F7', 'N SUBHASH'],['23KD1A05F9', 'N PRAVEEN KUMAR'],['23KD1A05G0', 'N KYATHI'],['23KD1A05G1', 'N PRANATHI'],
    ['23KD1A05G2', 'N HARI CHARAN'],['23KD1A05G3', 'NANADHINI M'],['23KD1A05G4', 'N CHANIKYA'],['23KD1A05G5', 'N MEGHANA'],
    ['23KD1A05G6', 'N SAITEJA'],['23KD1A05G7', 'N DRAKSHAMANI'],['23KD1A05G8', 'N LAVANYA'],['23KD1A05G9', 'N AISHWARYA'],
    ['23KD1A05H0', 'N GEETHA'],['23KD1A05H1', 'P CHIDVILAS'],['23KD1A05H2', 'P KIRAN'],['23KD1A05H3', 'P HARISHANKAR'],
    ['23KD1A05H4', 'P SAIKIRAN'],['23KD1A05H5', 'PVS POORNANANDA'],['23KD1A05H7', 'P GEETHASRI'],['23KD1A05H8', 'P KAVITHA'],
    ['23KD1A05I0', 'P VINEELA'],['23KD1A05I1', 'P SUMANTH'],['23KD1A05I2', 'P GEETHANJALI'],['23KD1A05I3', 'P DEEPIKA'],
    ['23KD1A05I4', 'P AMRUTHA'],['23KD1A05I6', 'P SRIVALLI'],['23KD1A05I7', 'P JAHNAVI'],['23KD1A05I8', 'P SURENDRA REDDY'],
    ['23KD1A05I9', 'P SRAVYA'],['23KD1A05J0', 'P SAHITH'],['23KD1A05J1', 'P BHAVYA SRI'],['23KD1A05J2', 'P MEENAKSHI'],
    ['23KD1A05J3', 'P PRIYANKA'],['23KD1A05J4', 'P CHITTI BABU'],['23KD1A05J5', 'P MYTHRI'],['23KD1A05J6', 'JAHNAVI LATHA'],
    ['23KD1A05J8', 'P VARUDHINI'],['24KD5A0512', 'P REENUKA'],['24KD5A0513', 'P NAGESHWARI'],['24KD5A0514', 'P VINAY'],
    ['24KD5A0515', 'R PREMKUMAR'],['24KD5A0516', 'S SUJATHA'],['24KD5A0517', 'S KUMARRAJA']
  ],
  D: [
    ['23KD1A05J9', 'PORAPU PADMA'],['23KD1A05K0', 'POTHINA APPALA DURGA GUNA MANASA SREE'],['23KD1A05K1', 'POTIPARTHI CHARISHMA'],['23KD1A05K2', 'POTIPIREDDI VANDANA'],
    ['23KD1A05K3', 'POTNURU LEELA KUMARI'],['23KD1A05K4', 'PUDI SANJANA'],['23KD1A05K5', 'PURIJALA RAMACHANDRA RAO'],['23KD1A05K6', 'PUSAPATI SATWIK VARMA'],
    ['23KD1A05K7', 'PUVVALA SAI BHARADWAJ'],['23KD1A05K8', 'PYLA SRAVYA'],['23KD1A05K9', 'RAGHUMANDA SAITEJA'],['23KD1A05L0', 'RAGHUMANDA SRAVANTHI'],
    ['23KD1A05L1', 'RAI CHIRANJEEVI'],['23KD1A05L2', 'RAJANA LIKHITHA'],['23KD1A05L3', 'RAJANA NAVEEN'],['23KD1A05L4', 'RAPARTHI CHANDU'],
    ['23KD1A05L5', 'REGETI SOWJANYA'],['23KD1A05L6', 'RIKKA KALYANI'],['23KD1A05L7', 'SAMBANA HARSHIT'],['23KD1A05L8', 'SANAPATHI MANJULA'],
    ['23KD1A05L9', 'SARIKI HEMANTH'],['23KD1A05M0', 'SATHI CHANDRA SEKHAR MANIKANTA REDDY'],['23KD1A05M1', 'SATHI SASINDRA CHAITANYA REDDY'],['23KD1A05M2', 'SATYAVARAPU RADHA'],
    ['23KD1A05M3', 'SETTY MOUNIKA TEJASWINI'],['23KD1A05M4', 'SHAIK ABEED'],['23KD1A05M5', 'SHEIK UMAR RAFEE'],['23KD1A05M6', 'SIDDA HITANSHA'],
    ['23KD1A05M7', 'SIMHADRI YASASWI'],['23KD1A05M8', 'SINGARAPU DIVYA'],['23KD1A05M9', 'SINKA VENU SREE'],['23KD1A05N0', 'SIRUVURI RAMYA'],
    ['23KD1A05N1', 'SRIDHARALA JASWANTH'],['23KD1A05N2', 'SUNKARI INDHU'],['23KD1A05N3', 'SUNKARI MOUNIKA'],['23KD1A05N4', 'SUNKARI VENKATA APOORVA'],
    ['23KD1A05N5', 'TADANGI KARTHIK'],['23KD1A05N6', 'TALADA VINAY KUMAR'],['23KD1A05N7', 'TALLAPUDI SALMON RAJ'],['23KD1A05N8', 'TANAVARAPU HARSHA VARDHAN'],
    ['23KD1A05N9', 'TELUKALA VIJAYKUMAR SAHU'],['23KD1A05O0', 'THAPPITA CHANDRA SEKHAR'],['23KD1A05O1', 'THONANGI KIRAN REDDY'],['23KD1A05O2', 'TIRUVEEDHULA KARTHIK'],
    ['23KD1A05O3', 'TOMPALA KARTHIK'],['23KD1A05O4', 'TULA SAI NAGA VENKATA SIRI'],['23KD1A05O5', 'UMMIREDDY GAYATRI'],['23KD1A05O6', 'UPPILI HARSHAVARDHAN'],
    ['23KD1A05O7', 'UTTARAVELLI NAVEEN KUMAR'],['23KD1A05O8', 'UYAKA SAILAJA'],['23KD1A05O9', 'VARANASI KEERTHANA'],['23KD1A05P0', 'VEJENDLA CHATURYA PHANI'],
    ['23KD1A05P1', 'VELUVALI  NAVYA SREE'],['23KD1A05P2', 'VEMPADAPU SUCHITRA'],['23KD1A05P3', 'VEMPALI SAMPATH KUMAR'],['23KD1A05P4', 'VENDRAPU RAMYA SREE'],
    ['23KD1A05P5', 'VIJINIGIRI LATHA'],['23KD1A05P6', 'VUDA GEETHA MADHURI'],['23KD1A05P7', 'YANDRAPU RAJESWARI'],['23KD1A05P8', 'YARABALA USHA SREE'],
    ['23KD1A05P9', 'YAVARNA SIREESHA'],['23KD1A05Q0', 'YEJJALA SIRI'],['23KD1A05Q1', 'YENDUVA VIKRAMADITYA NAIDU'],['23KD1A05Q2', 'YERRAMSETTI GOVARDHINI'],
    ['23KD1A05Q3', 'YERUBOTHU THANEESH KARTHEEK'],['24KD5A0518', 'SURAVARAPU DURGAPRASAD'],['24KD5A0519', 'TEEDA SIRISHA'],['24KD5A0520', 'TEJA SREE PENTYALA'],
    ['24KD5A0521', 'TETAKALI LAVANYA'],['24KD5A0522', 'VADAVALASA INDRASENA'],['24KD5A0523', 'YENUGULA ANITHA'],['24KD5A0524', 'YERLAJELLA KARTHIK'],
    ['24KD5A0525', 'REDDI SANDHYA']
  ]
};

// (Paste full lists for every section as in your previous uploads!)
function showForgotPassword() {
    document.getElementById('loginSection').style.display = 'none';
    document.getElementById('forgotSection').style.display = '';
}
function showLogin() {
    document.getElementById('loginSection').style.display = '';
    document.getElementById('forgotSection').style.display = 'none';
}
function logout() {
    document.getElementById('attendanceSection').style.display = 'none';
    document.getElementById('loginSection').style.display = '';
    clearMessages();
}
function clearMessages() {
    document.getElementById('loginMessage').textContent = '';
    document.getElementById('forgotMessage').textContent = '';
    document.getElementById('attendanceMessage').textContent = '';
    document.getElementById('checkMessage').textContent = '';
}
document.getElementById('sectionSelect').addEventListener('change', function() {
    const selectedSection = this.value;
    const studentsListDiv = document.getElementById('studentsList');
    studentsListDiv.innerHTML = '';
    if (!sectionStudents[selectedSection]) { return; }
    const header = document.createElement('div');
    header.className = 'row fw-bold mb-2';
    header.innerHTML = `
        <div class="col-3">Registration Number</div>
        <div class="col-6">Name</div>
        <div class="col-3">Status</div>
    `;
    studentsListDiv.appendChild(header);
    sectionStudents[selectedSection].forEach(([regNo, name]) => {
        const row = document.createElement('div');
        row.className = 'row align-items-center mb-2';
        row.innerHTML = `
            <div class="col-3"><input type="text" class="form-control" value="${regNo}" readonly /></div>
            <div class="col-6"><input type="text" class="form-control" value="${name}" readonly /></div>
            <div class="col-3"><select class="form-select" id="status-${regNo}">
                <option>Present</option>
                <option>Absent</option>
                <option>Late</option>
            </select></div>
        `;
        studentsListDiv.appendChild(row);
    });
});
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault(); clearMessages();
    const username = document.getElementById('usernameInput').value.trim();
    const password = document.getElementById('passwordInput').value;
    try {
        const res = await fetch('/api/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({username, password})
        });
        const data = await res.json();
        if (data.success) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('attendanceSection').style.display = '';
        } else {
            document.getElementById('loginMessage').textContent = data.error || 'Login failed';
        }
    } catch (error) {
        document.getElementById('loginMessage').textContent = 'Error during login';
    }
});
document.getElementById('forgotForm').addEventListener('submit', async (e) => {
    e.preventDefault(); clearMessages();
    const username = document.getElementById('forgotUsernameInput').value.trim();
    try {
        const res = await fetch('/api/forgot_password', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({username})
        });
        const data = await res.json();
        if (data.success) {
            document.getElementById('forgotMessage').textContent = 'Reset link sent!';
        } else {
            document.getElementById('forgotMessage').textContent = data.error || 'Failed to send reset link';
        }
    } catch (error) {
        document.getElementById('forgotMessage').textContent = 'Error sending reset link';
    }
});
document.getElementById('attendanceForm').addEventListener('submit', async (e) => {
    e.preventDefault(); clearMessages();
    const date = document.getElementById('dateInput').value;
    if (!date) {
        document.getElementById('attendanceMessage').textContent = 'Please select a date.'; return;
    }
    const selectedSection = document.getElementById('sectionSelect').value;
    if (!selectedSection) {
        document.getElementById('attendanceMessage').textContent = 'Please select a section.'; return;
    }
    const attendance = {};
    sectionStudents[selectedSection].forEach(([regNo, name]) => {
        const statusSelect = document.getElementById(`status-${regNo}`);
        const status = statusSelect ? statusSelect.value : 'Absent';
        attendance[regNo] = { name, status };
    });
    try {
        const res = await fetch('/api/save', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ date, attendance })
        });
        const data = await res.json();
        if (data.success) {
            document.getElementById('attendanceMessage').textContent = 'Attendance saved successfully.';
        } else {
            document.getElementById('attendanceMessage').textContent = data.error || 'Failed to save attendance.';
        }
    } catch (error) {
        document.getElementById('attendanceMessage').textContent = 'Error saving attendance.';
    }
});
function exportAbsentees() {
    const date = document.getElementById('dateInput').value;
    if (!date) {
        document.getElementById('attendanceMessage').textContent = 'Please enter a date to export absentees.'; return;
    }
    window.location.href = `/api/export_absentees/?date=${encodeURIComponent(date)}`;
}
document.getElementById('checkForm').addEventListener('submit', async (e) => {
    e.preventDefault(); clearMessages();
    const regno = document.getElementById('regnoInput').value.trim();
    const date = document.getElementById('checkDateInput').value;
    if (!regno || !date) {
        document.getElementById('checkMessage').textContent = 'Please enter registration number and date.'; return;
    }
    try {
        const res = await fetch(`/api/check?regno=${encodeURIComponent(regno)}&date=${encodeURIComponent(date)}`);
        const data = await res.json();
        document.getElementById('checkMessage').textContent = `Status: ${data.status}`;
    } catch (error) {
        document.getElementById('checkMessage').textContent = 'Error checking attendance.';
    }
});
</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
</body>
</html>
